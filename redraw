#!/bin/bash

FLAG=$1
test "x$FLAG" = x && FLAG=GB

>lastcompiled.c
DIPLAY_PID=
while true; do
	sleep .05
	if diff -u lastcompiled.c waveflag.c; then
		continue
	fi
	cp waveflag.c lastcompiled.c
	if gcc -std=c99 -Wall -Wextra lastcompiled.c `pkg-config --cflags --libs cairo` -o waveflag && ./waveflag waved- $FLAG.png; then
		test -n "$DISPLAY_PID" && kill "$DISPLAY_PID"
		display waved-$FLAG.png &
		DISPLAY_PID=$!
	fi
done
